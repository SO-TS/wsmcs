name: Deploy to VPS

on:
  push:
    branches: [ main ]  # 根据你的分支名调整

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # 如果你的静态网站需要构建步骤，在这里添加
      # 例如:
      # - name: Build site
      #   run: |
      #     npm install
      #     npm run build

      - name: Install sshpass
        run: sudo apt-get install sshpass
      
      - name: Deploy to VPS via rsync
        env:
          SSH_PASS: ${{ secrets.SSH_PASSWORD }}
          SSH_USER: ${{ secrets.SSH_USER }}
          SSH_HOST: ${{ secrets.SSH_HOST }}
        run: |
          # 禁用严格的主机密钥检查以避免首次连接提示
          mkdir -p ~/.ssh
          echo "StrictHostKeyChecking no" >> ~/.ssh/config
          
          # 使用sshpass和rsync部署文件
          # 如果你的站点有构建步骤，确保源目录正确 (例如: ./dist/)
          sshpass -p "$SSH_PASS" rsync -avz --delete ./ $SSH_USER@$SSH_HOST:/var/www/your-website/
