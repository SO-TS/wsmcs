# Nginx configuration for WSMCS website caching strategy
# Place this in your nginx server block

# 图片缓存 14 天 (1209600 秒)
location ~* \.(png|jpg|jpeg|gif|svg|webp|avif)$ {
  expires 14d;
  add_header Cache-Control "public, max-age=1209600, immutable";
  add_header Vary "Accept-Encoding";
}

# 字体缓存 30 天
location ~* \.(woff|woff2|ttf|otf|eot)$ {
  expires 30d;
  add_header Cache-Control "public, max-age=2592000, immutable";
  add_header Vary "Accept-Encoding";
}

# CSS 和 JS（带 hash）缓存 1 年
location ~* \.(?:js|css)$ {
  expires 1y;
  add_header Cache-Control "public, max-age=31536000, immutable";
  add_header Vary "Accept-Encoding";
}

# HTML 缓存 1 小时
location ~* \.html$ {
  expires 1h;
  add_header Cache-Control "public, max-age=3600, must-revalidate";
  add_header Vary "Accept-Encoding";
}

# 其他静态资源缓存 1 个月
location ~* \.(ico|pdf|flv)$ {
  expires 30d;
  add_header Cache-Control "public, max-age=2592000";
}

# 启用 Gzip 压缩
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss application/rss+xml font/truetype font/opentype application/vnd.ms-fontobject image/svg+xml;

# 针对 SPA 的重写规则
location / {
  try_files $uri $uri/ /index.html;
}
